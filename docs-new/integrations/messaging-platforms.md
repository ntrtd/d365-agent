# Integration: Messaging Platforms

Extend the reach of your D365 Agent by integrating it with popular messaging platforms like Microsoft Teams, WhatsApp, Slack, etc.

## General Approach

Most integrations involve creating a bot or application on the target platform that acts as an intermediary (**Application Backend**). This application receives messages from users on the platform and forwards relevant requests to your D365 Agent system (specifically, the Application Backend hosting the **`d365-agent-mcpclient-*`** library, potentially via a dedicated API). The agent's response, orchestrated via the client library and MCP Server, is then sent back through the platform application to the user.

## Microsoft Teams

*   **Integration Method:** Build a **Microsoft Bot Framework** bot specifically for Teams.
*   **Backend:** The Bot Framework bot's backend service acts as the Application Backend, using the appropriate `d365-agent-mcpclient-*` library.
*   **UI:** Leverage **Adaptive Cards** for rich interactions within Teams.
*   **Authentication:** Utilize Teams SSO or Bot Framework OAuth prompts.
*   **See Also:** [Bot Framework Integration Guide](./bot-framework.md)

## WhatsApp

*   **Integration Method:** Use the **WhatsApp Business Platform Cloud API**.
*   **Backend:** Create a dedicated Application Backend (e.g., Node.js Azure Function, Web App) to:
    *   Expose a **webhook** endpoint to receive incoming messages from WhatsApp Cloud API.
    *   Make authenticated **HTTP POST requests** to the WhatsApp Cloud API `/messages` endpoint to send replies.
*   **SDK:** The official `WhatsApp/WhatsApp-Nodejs-SDK` is **archived and not recommended**. Use standard HTTP clients (`axios`, `HttpClient`) or actively maintained community SDKs to interact with the Cloud API.
*   **Integration:** The WhatsApp Application Backend receives webhook messages, uses `d365-agent-mcpclient-*` library to orchestrate D365 tasks via MCP, formats the result, and sends the reply via the Cloud API.
*   **Considerations:** Requires handling webhook verification, API tokens, message templates, and potential rate limits.

## Other Platforms (e.g., Slack)

*   **Integration Method:** Utilize the specific platform's SDKs and APIs (e.g., Slack Bolt SDK).
*   **Backend:** Develop a dedicated Application Backend for that platform.
*   **Similar Pattern:** The backend typically involves:
    *   Receiving incoming messages/events (often via webhooks or socket connections).
    *   Parsing intent/data.
    *   Calling the `d365-agent-mcpclient-*` library for orchestration and MCP interaction.
    *   Formatting and sending responses back using the platform's API/SDK.

## General Considerations

*   **Message Formatting:** Adapt responses generated by the orchestration layer to the specific formatting capabilities (Markdown variations, interactive elements, card types) of each messaging platform.
*   **User Mapping:** Implement a strategy to identify the platform user and potentially map them to a D365 user/contact for context or permission checks.
*   **API Limits & Throttling:** Be mindful of and handle any rate limits imposed by the messaging platform APIs.
*   **Security:** Secure webhook endpoints and authenticate API calls to messaging platforms.
